# Maintainer: Michael Towers <gradgrind[at]online[dot]de>
pkgname=larch
pkgver=5.1.0
pkgrel=1

# If I need the architecture, I can get it as ${CARCH}

pkgdesc="Scripts for generating live Archlinux CDs and USB-sticks"
url="http://larch.berlios.de"
depends=()
arch=(i686 x86_64)
license=('GPL')
source=(larch-${pkgver}.tar.gz)

build() {
  mkdir -p ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larch/run ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larch/cd-root ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larch/docs ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larch/initcpio_files ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larch/live_files ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larch/profile0 ${startdir}/pkg/opt/larch
  cp ${startdir}/src/larch/buildlive ${startdir}/pkg/opt/larch

  cp -dr ${startdir}/src/larch/rebuild ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larch/rebuild/etc ${startdir}/pkg

  # Update PKGREBUILD version number
  sed -i "s|^pkgver=.*|pkgver=${pkgver}|" \
    ${startdir}/pkg/opt/larch/rebuild/PKGREBUILD
  sed -i "s|^pkgrel=.*|pkgrel=${pkgrel}|" \
    ${startdir}/pkg/opt/larch/rebuild/PKGREBUILD

  cp -dr ${startdir}/src/larch-live ${startdir}/pkg/opt/larch
  cp -dr ${startdir}/src/larchin ${startdir}/pkg/opt/larch

  # Compile additional initramfs utilities
  cd ${startdir}/src/larch/src
  klcc -static -o lodel lodel.c || return 1
  klcc -static -o rename rename.c || return 1
  mkdir ${startdir}/pkg/opt/larch/klibc
  cp lodel ${startdir}/pkg/opt/larch/klibc
  cp rename ${startdir}/pkg/opt/larch/klibc
}
